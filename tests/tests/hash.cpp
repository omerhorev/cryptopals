//
// Created by omerh on 18/11/2019.
//

#include <gtest/gtest.h>

#include <model/internal/hash/sha1.h>

struct test_vectors
{
    struct
    {
        const unsigned char data[64];
        size_t length;
    } parts[5];

    size_t count;
    const unsigned char hash[20];
};

TEST(hash, sha1)
{

    const test_vectors test_vectors[] = {
            /*{
                    {

                            {
                                    {189, 36,  109, 121, 241, 29,  15,  41,  160, 237, 84,  41,  195, 74,  48,  202, 32,  32,  57,  98,  154, 229, 186, 52,  195, 0,   186, 41,  235, 132, 14,  190, 212, 241, 162, 5,   215, 178, 21,  36,  61,  98,  217, 252, 20, 57,  87, 106, 211, 203, 234, 62,  81, 41,  133, 0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    55
                            }

                    },
                    1,
                    {159, 33,  215, 76,  122, 226, 27,  228, 83,  155, 165, 140, 22,  81,  11,  43,  63,  33,  16,  93}
            },*/
            {
                    {

                            {
                                    {71,  66,  100, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,  0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    3
                            },
                            {
                                    {187, 162, 120, 232, 252, 93,  194, 196, 114, 92,  7,   121, 48,  68,  109, 2,   7,   54,  191, 128, 143, 190, 147, 59,  10,  44,  39,  139, 203, 111, 34,  20,  127, 254, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,  0,  0,  0,   0, 0},
                                    34
                            }

                    },
                    2,
                    {19,  157, 208, 2,   219, 49,  141, 209, 54,  187, 12,  237, 124, 150, 120, 218, 120, 61,  225, 223}
            },
            {
                    {

                            {
                                    {233, 170, 160, 48,  17,  197, 93,  39,  95,  88,  162, 226, 63,  26,  102, 52,  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,  0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    16
                            },
                            {
                                    {252, 15,  232, 131, 161, 182, 44,  196, 243, 21,  236, 169, 122, 221, 186, 246, 110, 63,  39,  63,  110, 74,  203, 109, 199, 107, 77,  130, 220, 217, 244, 236, 186, 176, 65,  4,   122, 123, 83,  142, 253, 204, 45,  22,  102, 8,  10,  201, 63,  185, 26, 85,  198, 36,  119, 80, 185, 0,   0,  0,  0,  0,   0, 0},
                                    57
                            }

                    },
                    2,
                    {52,  8,   226, 254, 225, 69,  91,  238, 151, 234, 188, 83,  235, 211, 205, 91,  180, 251, 148, 39}
            },
            {
                    {

                            {
                                    {238, 79,  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,  0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    2
                            },
                            {
                                    {177, 122, 207, 69,  184, 75,  24,  187, 41,  158, 210, 12,  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,  0,  0,  0,   0, 0},
                                    12
                            },
                            {
                                    {68,  198, 251, 80, 235, 93,  126, 86,  141, 255, 76,  40,  0,   0,   0,   0,  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0,  0,  0, 0,  0,   0,  0,  0,   0,   0,  0,   0,   0,   0,   0,   0,   0,   0,   0,  0,  0,   0,   0,   0,   0,   0,   0,   0,   0,  0,  0,   0, 0, 0},
                                    12
                            }

                    },
                    3,
                    {147, 93,  81,  110, 187, 106, 185, 55,  109, 103, 232, 228, 234, 165, 40,  207, 53,  104, 109, 186}
            },
            {
                    {

                            {
                                    {61,  243, 222, 229, 154, 255, 102, 232, 70,  208, 185, 2,   26,  197, 208, 19,  254, 200, 28,  216, 35,  137, 57,  214, 228, 171, 104, 41,  42,  51,  174, 139, 186, 229, 252, 246, 97,  41,  208, 107, 248, 199, 220, 211, 88, 157, 71, 237, 129, 217, 93,  242, 70, 41,  140, 0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    55
                            },
                            {
                                    {209, 153, 72,  71,  50,  35,  254, 159, 164, 111, 36,  71,  197, 47,  32,  201, 10,  135, 88,  73,  222, 206, 204, 138, 47,  222, 72,  113, 50,  140, 228, 188, 61,  179, 1,   187, 217, 177, 94,  197, 155, 170, 100, 237, 174, 13, 128, 252, 189, 129, 81, 177, 108, 0,   0,   0,  0,   0,   0,  0,  0,  0,   0, 0},
                                    53
                            },
                            {
                                    {31,  129, 185, 91, 161, 154, 239, 199, 204, 153, 30,  62,  159, 168, 37,  24, 48,  209, 236, 236, 2,   47,  105, 95,  146, 65, 226, 101, 194, 7, 46, 46, 5, 96, 108, 81, 43, 239, 253, 49, 207, 244, 162, 237, 150, 179, 107, 146, 99, 49, 146, 127, 197, 145, 119, 211, 200, 119, 53, 15, 116, 0, 0, 0},
                                    61
                            },
                            {
                                    {0, 176, 63, 132, 72, 95, 173, 44, 226, 141, 205, 17, 9, 104, 76, 72, 113, 136, 235, 116, 70, 128, 198, 71, 103, 131, 192, 245, 100, 150, 197, 155, 206, 190, 127, 160, 41, 254, 205, 102, 178, 133, 101, 155, 0, 23, 164, 130, 198, 213, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                                    50
                            }

                    },
                    4,
                    {25,  27,  240, 87,  190, 194, 218, 207, 101, 75,  90,  36,  255, 155, 172, 145, 155, 236, 122, 45}
            },
            {
                    {

                            {
                                    {224, 255, 97,  225, 122, 89,  125, 42,  127, 199, 43,  152, 230, 103, 85,  190, 135, 10,  74,  44,  85,  27,  106, 178, 110, 38,  93,  139, 54,  224, 53,  243, 114, 174, 35,  96,  129, 108, 0,   0,   0,   0,   0,   0,   0,  0,   0,  0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    39
                            },
                            {
                                    {60,  115, 182, 103, 13,  227, 203, 26,  79,  168, 25,  87,  187, 162, 106, 123, 139, 46,  148, 121, 162, 110, 134, 53,  246, 19,  130, 209, 177, 113, 83,  97,  7,   156, 150, 135, 27,  118, 121, 237, 31,  115, 159, 200, 119, 33, 237, 6,   56,  162, 56, 98,  205, 194, 0,   79, 202, 193, 81, 85, 43, 195, 0, 0},
                                    62
                            },
                            {
                                    {194, 175, 242, 13, 248, 136, 225, 247, 255, 33,  253, 163, 6,   68,  89,  33, 209, 243, 84,  15,  69,  180, 190, 155, 67,  88, 89,  5,   0,   0, 0,  0,  0, 0,  0,   0,  0,  0,   0,   0,  0,   0,   0,   0,   0,   0,   0,   0,   0,  0,  0,   0,   0,   0,   0,   0,   0,   0,   0,  0,  0,   0, 0, 0},
                                    28
                            }

                    },
                    3,
                    {76,  173, 66,  68,  155, 207, 29,  107, 35,  167, 204, 45,  191, 157, 186, 13,  49,  40,  29,  72}
            },
            {
                    {

                            {
                                    {160, 248, 71,  209, 142, 172, 134, 126, 24,  183, 62,  174, 220, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,  0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    13
                            },
                            {
                                    {158, 9,   199, 78,  210, 157, 14,  93,  218, 133, 159, 198, 108, 238, 2,   196, 230, 193, 77,  96,  248, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,  0,  0,  0,   0, 0},
                                    21
                            }

                    },
                    2,
                    {189, 136, 156, 218, 100, 181, 236, 153, 20,  245, 181, 241, 88,  117, 191, 32,  54,  119, 121, 175}
            },
            {
                    {

                            {
                                    {198, 196, 26,  128, 255, 37,  133, 106, 17,  236, 23,  192, 68,  177, 102, 242, 142, 142, 248, 83,  66,  62,  21,  28,  136, 99,  74,  159, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,  0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    28
                            },
                            {
                                    {85,  156, 248, 1,   29,  51,  185, 120, 44,  124, 241, 53,  109, 47,  138, 212, 210, 218, 39,  179, 19,  248, 40,  208, 216, 156, 57,  8,   133, 43,  2,   104, 131, 19,  198, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,  0,  0,  0,   0, 0},
                                    35
                            }

                    },
                    2,
                    {14,  122, 91,  141, 25,  115, 229, 27,  100, 236, 254, 27,  22,  24,  85,  18,  250, 144, 31,  144}
            },
            {
                    {

                            {
                                    {39,  83,  246, 9,   140, 241, 211, 118, 143, 60,  186, 243, 62,  208, 20,  64,  62,  225, 137, 209, 12,  204, 209, 70,  170, 184, 33,  16,  170, 43,  54,  215, 194, 242, 243, 47,  44,  215, 206, 55,  226, 86,  193, 212, 36, 202, 94, 13,  61,  86,  190, 113, 89, 194, 5,   194, 0, 0, 0, 0, 0, 0, 0, 0},
                                    56
                            },
                            {
                                    {219, 96,  200, 94,  17,  188, 145, 230, 4,   252, 202, 242, 157, 243, 65,  184, 138, 254, 37,  118, 15,  145, 17,  251, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,  0,  0,  0,   0, 0},
                                    24
                            }

                    },
                    2,
                    {242, 16,  1,   7,   228, 64,  201, 162, 161, 21,  191, 241, 27,  137, 149, 69,  140, 42,  68,  163}
            },
            {
                    {

                            {
                                    {175, 83,  68,  146, 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,   0,  0,   0,   0,   0,   0,   0,  0,   0,   0,   0, 0, 0, 0, 0, 0, 0, 0},
                                    4
                            },
                            {
                                    {1,   242, 137, 240, 188, 205, 3,   26,  148, 100, 11,  247, 114, 49,  76,  237, 9,   128, 67,  169, 169, 12,  218, 211, 92,  29,  212, 219, 167, 228, 79,  52,  5,   251, 181, 85,  155, 106, 225, 120, 236, 214, 68,  230, 50,  0,  0,   0,   0,   0,   0,  0,   0,   0,   0,   0,  0,   0,   0,  0,  0,  0,   0, 0},
                                    45
                            },
                            {
                                    {213, 142, 240, 91, 121, 99,  229, 139, 6,   233, 168, 110, 128, 26,  229, 52, 75,  166, 83,  97,  104, 87,  104, 104, 100, 82, 0,   0,   0,   0, 0,  0,  0, 0,  0,   0,  0,  0,   0,   0,  0,   0,   0,   0,   0,   0,   0,   0,   0,  0,  0,   0,   0,   0,   0,   0,   0,   0,   0,  0,  0,   0, 0, 0},
                                    26
                            }

                    },
                    3,
                    {8,   1,   179, 161, 42,  122, 23,  141, 81,  103, 61,  19,  182, 44,  86,  91,  222, 183, 32,  123}
            }
    };

    model::internal::sha1<uint32_t, uint64_t, 0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0> a;

    for (const auto &test_vector : test_vectors)
    {
        unsigned char hash[20] = {0};

        for (int i = 0; i < test_vector.count; ++i)
        {
            a.update(test_vector.parts[i].data, test_vector.parts[i].length);
        }

        a.digest(hash, sizeof(hash));

        ASSERT_TRUE(std::equal(hash, hash + 20, test_vector.hash));
    }
}